
===========================================================================================

Passo 1: Criar o Projeto Next.js com Tailwind CSS
Este comando cria um novo projeto Next.js já configurado com TypeScript e Tailwind CSS, que são a base do projeto de exemplo.

Bash

npx create-next-app@latest nome-do-seu-app --typescript --tailwind --eslint

√ Would you like your code inside a `src/` directory? ... No / Yes
√ Would you like to use App Router? (recommended) ... No / Yes
√ Would you like to use Turbopack for `next dev`? ... No / Yes
√ Would you like to customize the import alias (`@/*` by default)? ... No / Yes


cd nome-do-seu-app
===========================================================================================

Passo 2: Instalar a Biblioteca para Requisições HTTP (Axios)
O projeto utiliza o Axios para se comunicar com a API. Instale-o como uma dependência.

Bash

npm install axios
===========================================================================================

Passo 3: Estrutura de Pastas e Arquivos
Organize o projeto criando as seguintes pastas e arquivos dentro de src/ para manter o código limpo e escalável.

app/: Contém as rotas e páginas da aplicação.

layout.tsx: Layout principal que envolve todas as páginas.
globals.css: Estilos globais.
page.tsx: A página inicial (/).
page.module.css

produto/listar/page.tsx: A página para listar produtos (/produto/listar).
usuario/login/page.tsx: A página de login (/usuario/login).


services/: Centraliza a lógica de comunicação com a API.
api.ts: Configuração da instância do Axios.

types/: Define os tipos TypeScript para os dados da aplicação.
produto.ts: Interface para o modelo Produto.
===========================================================================================

Passo 4: Definir Tipos (TypeScript)
Crie o arquivo que define a estrutura de dados de um produto.

src/types/produto.ts

TypeScript

export interface Produto {
    id: number;
    nome: string;
    criadoEm: string; 
}

// Define os valores exatos que a propriedade 'permissao' pode ter.
// Isso garante que você não possa atribuir um valor inválido por engano no seu código.
export type Permissao = 'usuario' | 'administrador';


// Importa o tipo Permissao para ser usado na interface
import { Permissao } from './permissao';

export interface Usuario {
  id: number;
  email: string;
  senha?: string; 
  permissao: Permissao;
  
  // Mantido como string para ser consistente com sua interface 'Produto'.
  criadoEm: string; 
}
===========================================================================================

Passo 5: Configurar o Cliente API (Axios)
import axios from 'axios';

const api = axios.create({
  // Endereço correto da sua API backend, conforme `launchSettings.json`.
  baseURL: 'http://localhost:5058/api', 
});

// 1. Interceptor para adicionar o token de autenticação.
// Esta função intercepta cada requisição para adicionar o token, se ele existir.
api.interceptors.request.use(
  async (config) => {
    // Tenta obter o token do localStorage.
    const token = localStorage.getItem('authToken');
    if (token) {
      // Se o token existir, adiciona-o ao cabeçalho de autorização.
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    // Em caso de erro na configuração da requisição, rejeita a promise.
    return Promise.reject(error);
  }
);

export default api;

===========================================================================================

5.1

src/app

import Login from "./usuario/login/page";

export default function Home() {
  return (
    <div>
      <Login></Login>
    </div>
  );
}





Passo 6: Criar a Página de Listagem de Produtos
Esta página buscará os dados da API e os exibirá em um formato de tabela.

src/app/produto/listar/page.tsx

TypeScript

'use client';

import { useEffect, useState } from 'react';
import api from '@/services/api';
import { Produto } from '@/types/produto'; // Certifique-se que seu tipo Produto tem id, nome e criadoEm
import { useRouter } from 'next/navigation';

export default function ListarProdutos() {
  const [produtos, setProdutos] = useState<Produto[]>([]);
  const [permissao, setPermissao] = useState<string | null>(null);
  const router = useRouter();

  // --- State para o Modal de Edição/Criação ---
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingProduto, setEditingProduto] = useState<Produto | null>(null);
  const [nomeProduto, setNomeProduto] = useState('');
  // ---------------------------------------------

  // Função para buscar os produtos da API
  const fetchProdutos = async () => {
    try {
      const response = await api.get('/produto/listar');
      setProdutos(response.data);
    } catch (error) {
      console.error('Erro ao buscar produtos:', error);
      router.push('/usuario/login');
    }
  };

  // Efeito para buscar a permissão do usuário e os produtos ao montar o componente
  useEffect(() => {
    const userPermission = localStorage.getItem('userPermission');
    setPermissao(userPermission);
    fetchProdutos();
  }, []); // Executa apenas uma vez

  const isAdmin = permissao === 'administrador';

  // --- Funções do CRUD ---

  const handleOpenCreateModal = () => {
    setEditingProduto(null);
    setNomeProduto('');
    setIsModalOpen(true);
  };

  const handleOpenEditModal = (produto: Produto) => {
    setEditingProduto(produto);
    setNomeProduto(produto.nome);
    setIsModalOpen(true);
  };

  const handleCloseModal = () => {
    setIsModalOpen(false);
  };

  const handleSave = async () => {
    if (!nomeProduto.trim()) {
      alert('O nome do produto não pode estar vazio.');
      return;
    }

    try {
      if (editingProduto) {
        // Atualizar (PUT)
        await api.put(`/produto/${editingProduto.id}`, { nome: nomeProduto });
      } else {
        // Cadastrar (POST)
        await api.post('/produto/cadastrar', { nome: nomeProduto });
      }
      handleCloseModal();
      fetchProdutos(); // Recarrega a lista para mostrar as mudanças
    } catch (error) {
      console.error('Erro ao salvar produto:', error);
      alert('Falha ao salvar o produto. Verifique o console para mais detalhes.');
    }
  };

  const handleDelete = async (id: number) => {
    if (window.confirm('Tem certeza que deseja deletar este produto?')) {
      try {
        await api.delete(`/produto/${id}`);
        fetchProdutos(); // Recarrega a lista
      } catch (error) {
        console.error('Erro ao deletar produto:', error);
        alert('Falha ao deletar o produto.');
      }
    }
  };

  return (
    <div className="container mx-auto p-4">
      <div className="flex justify-between items-center mb-4">
        <h1 className="text-2xl font-bold">Lista de Produtos</h1>
        {isAdmin && (
          <button
            onClick={handleOpenCreateModal}
            className="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
          >
            Cadastrar Novo Produto
          </button>
        )}
      </div>

      {/* Tabela de Produtos */}
      <table className="min-w-full bg-white border">
        <thead>
          <tr>
            <th className="py-2 px-4 border-b">Nome</th>
            <th className="py-2 px-4 border-b">Criado Em</th>
            {isAdmin && <th className="py-2 px-4 border-b">Ações</th>}
          </tr>
        </thead>
        <tbody>
          {produtos.map((produto) => (
            <tr key={produto.id}>
              <td className="py-2 px-4 border-b">{produto.nome}</td>
              <td className="py-2 px-4 border-b">{new Date(produto.criadoEm).toLocaleDateString()}</td>
              {isAdmin && (
                <td className="py-2 px-4 border-b text-center">
                  <button
                    onClick={() => handleOpenEditModal(produto)}
                    className="bg-blue-500 hover:bg-blue-700 text-white text-sm font-bold py-1 px-2 rounded mr-2"
                  >
                    Editar
                  </button>
                  <button
                    onClick={() => handleDelete(produto.id)}
                    className="bg-red-500 hover:bg-red-700 text-white text-sm font-bold py-1 px-2 rounded"
                  >
                    Deletar
                  </button>
                </td>
              )}
            </tr>
          ))}
        </tbody>
      </table>

      {/* Modal de Criação/Edição */}
      {isModalOpen && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
          <div className="bg-white p-6 rounded shadow-lg w-96">
            <h2 className="text-xl font-bold mb-4">
              {editingProduto ? 'Editar Produto' : 'Cadastrar Produto'}
            </h2>
            <div className="mb-4">
              <label htmlFor="nome" className="block text-sm font-bold mb-2">Nome do Produto</label>
              <input
                id="nome"
                type="text"
                value={nomeProduto}
                onChange={(e) => setNomeProduto(e.target.value)}
                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700"
              />
            </div>
            <div className="flex justify-end">
              <button
                onClick={handleCloseModal}
                className="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded mr-2"
              >
                Cancelar
              </button>
              <button
                onClick={handleSave}
                className="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded"
              >
                Salvar
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
===========================================================================================

Passo 7: Criar a Página de Login
Crie o formulário de login. A lógica de autenticação (envio de dados para a API e armazenamento de token) seria adicionada aqui.

src/app/usuario/login/page.tsx

TypeScript

'use client';

import { useState } from 'react';
import api from '@/services/api'; 
import { useRouter } from 'next/navigation';

type Permissao = 'usuario' | 'administrador';

interface LoginResponse {
  token: string;
  permissao: Permissao;
}

export default function Login() {
  const [email, setEmail] = useState('');
  const [senha, setSenha] = useState('');
  const [error, setError] = useState('');
  const router = useRouter();

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    try {
      const response = await api.post<LoginResponse>('/usuario/login', { email, senha });
      
      const { token, permissao } = response.data;

      if (token && permissao) {
        localStorage.setItem('authToken', token);
        localStorage.setItem('userPermission', permissao);

      
        router.push('/produto/listar'); 

      } else {
        throw new Error('Resposta inválida da API.');
      }

    } catch (err) {
      setError('Login falhou. Verifique suas credenciais ou contate o suporte.');
      console.error('Falha no login', err);
    }
  };

  return (
    <div className="flex items-center justify-center h-screen">
      <form onSubmit={handleLogin} className="bg-white p-6 rounded shadow-md w-80">
        <h1 className="text-2xl font-bold mb-4">Login</h1>
        {error && <p className="text-red-500 text-sm mb-4">{error}</p>}
        <div className="mb-4">
          <label className="block text-sm font-bold mb-2" htmlFor="email">
            Email
          </label>
          <input
            id="email"
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700"
            required
          />
        </div>
        <div className="mb-6">
          <label className="block text-sm font-bold mb-2" htmlFor="password">
            Senha
          </label>
          <input
            id="password"
            type="password"
            value={senha}
            onChange={(e) => setSenha(e.target.value)}
            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700"
            required
          />
        </div>
        <button
          type="submit"
          className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-full"
        >
          Entrar
        </button>
      </form>
    </div>
  );
}
===========================================================================================

Passo 8: Rodar a Aplicação
Com a API de backend em execução, inicie o servidor de desenvolvimento do Next.js.

Bash

npm run dev